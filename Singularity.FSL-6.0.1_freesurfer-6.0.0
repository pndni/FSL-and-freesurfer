Bootstrap: yum
OSVersion: 7
MirrorURL: http://mirror.centos.org/centos-%{OSVERSION}/%{OSVERSION}/os/x86_64/
Include: yum

%post
    yum install -y wget file bc tar gzip libquadmath which bzip2

%appinstall freesurfer
    wget --no-verbose https://surfer.nmr.mgh.harvard.edu/pub/dist/freesurfer/6.0.0/freesurfer-Linux-centos6_x86_64-stable-pub-v6.0.0.tar.gz
    tar -C $SCIF_APPROOT -xzvf freesurfer-Linux-centos6_x86_64-stable-pub-v6.0.0.tar.gz
    rm freesurfer-Linux-centos6_x86_64-stable-pub-v6.0.0.tar.gz

%appenv freesurfer
    export FREESURFER_HOME=$SCIF_APPROOT
    source $FREESURFER_HOME/SetUpFreeSurfer.sh

%appinstall FSL
    wget --output-document=/tmp/fslinstaller.py https://fsl.fmrib.ox.ac.uk/fsldownloads/fslinstaller.py 
    # FSL gets upset if it tries to install into a non-empty directory
    # so here we remove the directory, install fsl, and then restore the scif metadata
    cd ..
    mv $SCIF_APPROOT/scif /tmp/scif
    rmdir $SCIF_APPROOT/bin
    rmdir $SCIF_APPROOT/lib
    rmdir $SCIF_APPROOT
    python /tmp/fslinstaller.py -V 6.0.1 -d $SCIF_APPROOT
    cd $SCIF_APPROOT
    mv /tmp/scif scif

%appenv FSL
    source $SCIF_APPROOT/etc/fslconf/fsl.sh